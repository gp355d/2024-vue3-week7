import{M as L}from"./modal-x08_P0Zp.js";import{_ as P,o as d,c as i,a as t,t as n,F as f,g as V,v as w,f as x,r as v,h,b as u,w as S,n as q,e as b,i as C,j as A,k}from"./index-WOhg-j9r.js";const $={data(){return{qty:1,modal:""}},props:["tempProduct"],template:"#userProductModal",mounted(){this.modal=new L(this.$refs.exampleModal,{keyboard:!1,backdrop:"static"})},watch:{tempProduct(){this.qty=1}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}}},E={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"exampleModal"},T={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},D={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},N=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},B={class:"row"},O={class:"col-sm-6"},z=["src"],j={class:"col-sm-6"},G={class:"badge bg-primary rounded-pill"},H={key:0,class:"h5"},J={class:"h6"},K={class:"h5"},Q={class:"input-group"},W=["value"];function X(a,e,l,g,o,m){return d(),i("div",E,[t("div",T,[t("div",U,[t("div",D,[t("h5",F,[t("span",null,n(l.tempProduct.title),1)]),N]),t("div",R,[t("div",B,[t("div",O,[t("img",{class:"img-fluid",src:l.tempProduct.imageUrl,alt:""},null,8,z)]),t("div",j,[t("span",G,n(l.tempProduct.category),1),t("p",null,"商品描述："+n(l.tempProduct.description),1),t("p",null,"商品內容："+n(l.tempProduct.content),1),l.tempProduct.price===l.tempProduct.origin_price?(d(),i("div",H,n(l.tempProduct.origin_price)+" 元",1)):(d(),i(f,{key:1},[t("del",J,"原價 "+n(l.tempProduct.origin_price)+" 元",1),t("div",K,"現在只要 "+n(l.tempProduct.price)+" 元",1)],64)),t("div",null,[t("div",Q,[V(t("select",{class:"form-select",name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=c=>o.qty=c)},[(d(),i(f,null,x(10,c=>t("option",{value:c,key:c},n(c),9,W)),64))],512),[[w,o.qty]]),t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=c=>a.$emit("add-to-cart",l.tempProduct.id,o.qty))},"加入購物車")])])])])])])])],512)}const Y=P($,[["render",X]]);var Z={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"leo535",BASE_URL:"/2024-vue3-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:_,VITE_APP_API_NAME:p}=Z,tt={data(){return{products:[],product:{},cart:{},isLoadingStatus:{isLoading:!1,cartLoading:""},form:{email:"",name:"",phone:"",address:"",msg:""}}},methods:{getProducts(){const a=this.$loading.show();this.axios.get(`${_}/api/${p}/products`).then(e=>{this.products=e.data.products,a.hide()}).catch(e=>{alert(e.response.data.message),console.log(e.data)})},getProduct(a){const e=this.$loading.show();this.isLoadingStatus.ItemId=a,this.axios.get(`${_}/api/${p}/product/${a}`).then(l=>{this.product=l.data.product,e.hide(),this.isLoadingStatus.ItemId="",this.$refs.userProductModal.openModal()}).catch(l=>{alert(l.response.data.message)})},addToCart(a,e=1){const l={data:{product_id:a,qty:e}},g=this.$loading.show();this.isLoadingStatus.ItemId=a,this.axios.post(`${_}/api/${p}/cart`,l).then(o=>{alert(o.data.message),this.getCarts(),this.isLoadingStatus.ItemId="",this.$refs.userProductModal.closeModal(),g.hide()}).catch(o=>{alert(o.response.data.message)})},getCarts(){const a=this.$loading.show();this.axios.get(`${_}/api/${p}/cart`).then(e=>{this.cart=e.data.data,a.hide()}).catch(e=>{alert(e.response.data.message)})},changeToCart(a,e=1){const l={data:{product_id:a.product_id,qty:e}};this.isLoadingStatus.cartLoading=a.id,this.axios.put(`${_}/api/${p}/cart/${a.id}`,l).then(g=>{alert(g.data.message),this.getCarts(),this.isLoadingStatus.cartLoading="",this.$refs.userProductModal.closeModal()}).catch(g=>{alert(g.response.data.message)})},deleteCart(a){const e=this.$loading.show();this.axios.delete(`${_}/api/${p}/cart/${a}`).then(l=>{e.hide(),alert("該商品"+l.data.message),this.getCarts()}).catch(l=>{alert(l.response.data.message)})},deleteAllCarts(){const a=this.$loading.show();this.axios.delete(`${_}/api/${p}/carts`).then(e=>{alert("購物車列表"+e.data.message),this.getCarts(),a.hide()}).catch(e=>{alert(e.response.data.message)})},sendOrder(){const a={user:{name:this.form.name,email:this.form.email,tel:this.form.tel,address:this.form.address},message:this.form.msg};this.axios.post(`${_}/api/${p}/order`,{data:a}).then(e=>{const l=this.$loading.show();console.log(e.data),alert(e.data.message),this.$refs.form.resetForm(),this.getCarts(),l.hide()}).catch(e=>{alert(e.response.data)})}},mounted(){this.getProducts(),this.getCarts()},components:{DetailProduct:Y}},et={class:"row"},st=t("h2",null,"這是結帳頁",-1),ot={class:"container"},lt={class:"mt-4"},at={class:"table align-middle"},dt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),it={style:{width:"200px"}},nt={key:0,class:"h5"},rt={class:"h6"},ct={class:"h5"},ut={class:"btn-group btn-group-sm"},mt=["disabled","onClick"],ht={key:0,class:"fa fa-spinner fa-pulse"},_t=["onClick","disabled"],pt={key:0,class:"fa fa-spinner fa-pulse"},gt={class:"text-end"},bt=["disabled"],ft={class:"table align-middle"},yt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"200px"}},"數量/單位"),t("th",null,"單價")])],-1),vt=["onClick"],kt={key:0,class:"fas fa-spinner fa-pulse"},xt={key:0,class:"text-success"},Ct={class:"input-group input-group-sm"},Pt={class:"input-group mb-3"},Vt=["onClick"],Mt=["onUpdate:modelValue","disabled"],It=["disabled","onClick"],Lt={class:"input-group-text",id:"basic-addon2"},wt={class:"text-end"},St={key:0,class:"text-success"},qt={key:0},At=t("td",{colspan:"3",class:"text-end"},"總計",-1),$t={class:"text-end"},Et={key:0},Tt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Ut={class:"text-end text-success"},Dt={class:"my-5 row justify-content-center"},Ft={class:"mb-3"},Nt=t("label",{for:"email",class:"form-label"},"Email",-1),Rt={class:"mb-3"},Bt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ot={class:"mb-3"},zt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),jt={class:"mb-3"},Gt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ht={class:"mb-3"},Jt=t("label",{for:"message",class:"form-label"},"留言",-1),Kt={class:"text-end"},Qt=["disabled"];function Wt(a,e,l,g,o,m){const c=v("VField"),y=v("ErrorMessage"),M=v("VForm"),I=v("DetailProduct");return d(),i("div",et,[st,t("div",ot,[t("div",lt,[t("table",at,[dt,t("tbody",null,[(d(!0),i(f,null,x(o.products,s=>(d(),i("tr",{key:s.id},[t("td",it,[t("div",{style:q([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",null,n(s.title),1),t("td",null,[s.price===s.origin_price?(d(),i("div",nt,n(s.origin_price)+" 元",1)):(d(),i(f,{key:1},[t("del",rt,"原價 "+n(s.origin_price)+" 元",1),t("div",ct,"現在只要 "+n(s.price)+" 元",1)],64))]),t("td",null,[t("div",ut,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:o.isLoadingStatus.ItemId===s.id,onClick:r=>m.getProduct(s.id)},[o.isLoadingStatus.ItemId===s.id?(d(),i("i",ht)):h("",!0),b(" 查看更多 ")],8,mt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:r=>m.addToCart(s.id),disabled:o.isLoadingStatus.ItemId===s.id},[o.isLoadingStatus.ItemId===s.id?(d(),i("i",pt)):h("",!0),b(" 加到購物車 ")],8,_t)])])]))),128))])]),t("div",gt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...s)=>m.deleteAllCarts&&m.deleteAllCarts(...s)),disabled:!o.cart.final_total},"清空購物車",8,bt)]),t("table",ft,[yt,t("tbody",null,[o.cart.carts?(d(!0),i(f,{key:0},x(o.cart.carts,s=>(d(),i("tr",{key:s.id+"cart"},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>m.deleteCart(s.id)},[o.isLoadingStatus.loadingItem?(d(),i("i",kt)):h("",!0),b(" x ")],8,vt)]),t("td",null,[b(n(s.product.title)+" ",1),s.coupon?(d(),i("div",xt," 已套用優惠券 ")):h("",!0)]),t("td",null,[t("div",Ct,[t("div",Pt,[t("button",{type:"button",class:"btn btn-primary",onClick:C(r=>{s.qty++,m.changeToCart(s,s.qty)},["prevent"])},"+",8,Vt),V(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":r=>s.qty=r,disabled:o.isLoadingStatus.cartLoading===s.id,readonly:""},null,8,Mt),[[A,s.qty]]),t("button",{type:"button",class:"btn btn-primary",disabled:s.qty===1,onClick:C(r=>{s.qty--,m.changeToCart(s,s.qty)},["prevent"])},"-",8,It),t("span",Lt,n(s.product.unit),1)])])]),t("td",wt,[s.final_total!==s.total?(d(),i("small",St,"折扣價：")):h("",!0),b(" $"+n(s.final_total),1)])]))),128)):h("",!0)]),o.cart.length!==0?(d(),i("tfoot",qt,[t("tr",null,[At,t("td",$t,"$"+n(o.cart.total),1)]),o.cart.final_total!==o.cart.total?(d(),i("tr",Et,[Tt,t("td",Ut,"$"+n(o.cart.final_total),1)])):h("",!0)])):h("",!0)])]),t("div",Dt,[u(M,{ref:"form",class:"col-md-6",onSubmit:m.sendOrder},{default:S(({errors:s})=>[t("div",Ft,[Nt,u(c,{id:"email",name:"email",type:"email",class:k(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.email,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.email=r)},null,8,["class","modelValue"]),u(y,{name:"email",class:"invalid-feedback"})]),t("div",Rt,[Bt,u(c,{id:"name",name:"姓名",type:"text",class:k(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.name=r)},null,8,["class","modelValue"]),u(y,{name:"姓名",class:"invalid-feedback"})]),t("div",Ot,[zt,u(c,{id:"tel",name:"電話",type:"tel",class:k(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.tel=r)},null,8,["class","modelValue"]),u(y,{name:"電話",class:"invalid-feedback"})]),t("div",jt,[Gt,u(c,{id:"address",name:"地址",type:"text",class:k(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.address,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.address=r)},null,8,["class","modelValue"]),u(y,{name:"地址",class:"invalid-feedback"})]),t("div",Ht,[Jt,u(c,{name:"留言",id:"message",class:"form-control",cols:"30",rows:"10",modelValue:o.form.msg,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.msg=r),as:"textarea"},null,8,["modelValue"])]),t("div",Kt,[t("button",{type:"submit",class:"btn btn-danger",disabled:o.form.email===""||o.form.name===""||o.form.tel===""||o.form.address===""||o.cart.final_total===0},"送出訂單",8,Qt)])]),_:1},8,["onSubmit"])]),u(I,{ref:"userProductModal","temp-product":o.product,onAddToCart:m.addToCart},null,8,["temp-product","onAddToCart"])])])}const Zt=P(tt,[["render",Wt]]);export{Zt as default};
